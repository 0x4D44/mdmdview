# JRN - Regression Visual Test Suite

Date: 2025.12.25

## Entry 1
Started implementation for the regression visual test suite. Created the initial journal and prepared to add the Stage 0 decision log plus the Stage 1 corpus/manifest scaffolding.

## Entry 2
Stage 0/1: Added `tests/regression` scaffold with decisions in `tests/regression/README.md`, created `manifest.toml`, and wrote initial case markdown files plus local assets (`image-a.png`, `diagram.svg`) for image tests.

## Entry 3
Implemented Stage 2 screenshot mode: added CLI parsing for screenshot flags, deterministic capture flow, content-only chrome hiding, scroll offset support, settle-frame logic, metadata JSON output, zoom scale setter, and pending-render checks. Added regression tooling scaffolding (reference CSS, reference renderer, runner, requirements) plus a Windows CI smoke workflow and README updates for regression usage.

## Entry 4
Expanded Stage 3/4/5 support: added optional font-bundle handling in the reference renderer, wired `--test-fonts` through the runner, and recorded Playwright/browser versions in reference metadata. Implemented per-case diff mask support in the runner with mask-aware diff metrics. Updated regression docs, added a fonts README, ignored generated artifacts in git, and added CI caching for Playwright and reference outputs.

## Entry 5
Validation: `cargo fmt --all`, `cargo clippy --all-targets -- -D warnings`, and `cargo build --release`.

## Entry 6
Tried to install regression Python deps on Python 3.13 to generate reference outputs; Playwright's greenlet dependency failed to build (cp313). Updated `pillow` pin to 11.0.0 and noted Python 3.11/3.12 requirement in docs. Reference outputs still need to be generated with a supported Python version.

## Entry 7
Updated Playwright to 1.57.0 for cp313 wheels, installed Chromium, fixed reference renderer API usage, removed BOM in manifest, and generated reference outputs. Adjusted screenshot handling to normalize DPI and allow viewport resizing in screenshot mode. Set regression comparisons to use mdmdview baselines by default while still generating canonical references; captured new baselines and verified `runner.py run` passes. Ran `cargo clippy --all-targets -- -D warnings` after updates.

## Entry 8
Expanded regression documentation with setup steps, comparison modes, tolerances/mask guidance, and troubleshooting notes. Updated top-level README visual regression instructions.

## Entry 9
Ran `cargo clippy --all-targets -- -D warnings` after the latest screenshot/DPI changes and doc updates.

## Entry 10
Added comprehensive table regression cases (alignments, wrapping, escaping, missing/extra cells, inline elements, wide tables), updated the manifest, regenerated references/baselines, and reviewed outputs for table-specific issues.

## Entry 11
Implemented table alignment propagation through layout jobs/caching and render paths, added table-row inline-code pipe escaping with restore logic, and enabled horizontal scrolling for legacy/no-wrap wide tables. Added a unit test for code pipes inside table cells. Ran `cargo fmt --all` and `cargo test`.

## Entry 12
Updated table baselines for alignment/pipe fixes and reran regression suite (0 failures). Addressed clippy warnings (trim_end_matches, too many args) and ran `cargo clippy --all-targets -- -D warnings`.

## Entry 13
Added regression cases for table line breaks and legacy no-wrap missing cells, fixed `<br>` handling in inline parsing, and ensured legacy tables render empty cells/extra columns consistently. Ran `cargo fmt --all`, `cargo test`, rebuilt release, updated baselines for new cases, and reran the regression suite (0 failures).

## Entry 14
Handled `<br>`/breaks inside inline styles (strong/emphasis/links) by threading break handling into `collect_until_tag_end`. Added a bold line-break row to the table line-breaks case, updated its baseline, and reran `cargo fmt --all`, `cargo test`, rebuild, and the regression suite (0 failures).

## Entry 15
Fixed HTML `<br>` detection to accept attributes (e.g., `<br class="tight">`). Added an attribute break row to the table line-breaks case, updated its baseline, and reran `cargo fmt --all`, `cargo test`, rebuild, and the regression suite (0 failures).
