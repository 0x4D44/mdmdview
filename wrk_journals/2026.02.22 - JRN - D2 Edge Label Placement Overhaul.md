# Journal — D2 Edge Label Placement Overhaul

Date: 2026.02.22
Design: `wrk_docs/2026.02.22 - HLD - D2 Edge Label Placement Overhaul V4.md`

## Objective

Implement three coordinated fixes from HLD V4:
- **Fix A**: Expand SVG viewBox to include edge label bounding rects (prevents clipping)
- **Fix B**: Bidirectional perpendicular offset in `label_position_at` + `compute_label_position`
- **Fix C**: Binary on-edge fallback for wide labels (>72px threshold)

## Implementation Plan (from HLD V4 §5)

Recommended order: A → B+C (B and C modify the same function).

| Stage | Scope | Status |
|-------|-------|--------|
| 1 | Fix A: viewBox expansion in `svg_render.rs` | Pending |
| 2 | Fixes B+C: bidirectional offset + on-edge fallback in `edge_routing.rs` | Pending |
| 3 | New tests from §7.1 | Pending |
| 4 | Full test suite + conformance verification | Pending |
| 5 | Final design-vs-implementation comparison | Pending |

Each stage: implement (agent) → review (code-reviewer) → apply feedback → commit.

## Log

### Stage 1: Fix A — ViewBox Expansion
- [ ] Implement
- [ ] Review
- [ ] Apply feedback
- [ ] Verify tests pass
- [ ] Commit
