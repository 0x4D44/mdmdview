# 2026.01.01 - Mermaid QuickJS DOM Fixes

- Investigated embedded mermaid QuickJS failures; confirmed DOMPurify factory returned a non-functional object without sanitize when DOM shim lacked real DOM support.
- Patched embedded mermaid JS at load time to add a DOMPurify fallback sanitize/addHook shim when sanitize is missing.
- Extended the DOM shim with attribute selectors, tag#id matching, and selector matching support to keep d3 selections from filtering out nodes.
- Added inner/outer HTML serialization for the shim so mermaid can extract rendered SVG from the pseudo-DOM.
- Simplified mermaid render wrapper and removed temporary debug instrumentation after render succeeded.
- Test: `cargo test --features mermaid-quickjs mermaid_renderer::tests::test_mermaid_quickjs_render_smoke -- --nocapture`
- Added new mermaid visual cases for subgraphs, alt/loop sequences, nested states, and richer class diagrams.
- Files: tests/mermaid_visual/cases/flowchart_subgraph.md, sequence_alt_loop.md, state_nested.md, class_complex.md.
