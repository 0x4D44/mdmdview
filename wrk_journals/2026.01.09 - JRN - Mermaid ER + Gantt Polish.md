# 2026.01.09 - JRN - Mermaid ER + Gantt Polish

## Summary
- Investigated remaining ER background and gantt font-size diffs; gantt already within threshold after viewport width fix.
- Identified ER visual diff as size mismatch (QuickJS output slightly larger than mermaid-cli).
- Added kerning-aware text measurement and ER-specific scale adjustment to reduce ER output size.

## Work Completed
- Added kerning support to TextMeasurer using `kern` subtables when available to match browser text widths.
- Added ER-only scale adjustment during rasterization to reduce overall size mismatch.
- Added tests for kerning and scale adjustment helpers.
- Rebuilt release and reran mermaid visual comparison for ER + gantt.

## Tests / Validation
- `cargo test --features mermaid-quickjs test_text_measurer_kerning_adjusts_width_when_available`
- `cargo test --features mermaid-quickjs test_scale_adjustment_for_svg_defaults`
- `python tools/mermaid_review_pack.py --case er --case gantt --output tests/mermaid_visual/review_pack/2026.01.08-fix10`

## Results
- ER diff now within threshold (7.93%).
- Gantt remains within threshold.

## Full Pack Run
- Ran full pack: `python tools/mermaid_review_pack.py --output tests/mermaid_visual/review_pack/2026.01.09-full` (long run; warnings from zenuml).
- All cases passed except `class` (diff 12.86%, threshold 10%).

## Mindmap Edge Trim Fix
- Noticed mindmap edges were stopping short of node bounds.
- Added overlap padding in mindmap edge trimming to push the link endpoints under node borders.
- Added test to assert overlap padding is present.
- Reran mindmap comparison pack.

## Mindmap Tests / Validation
- `cargo test --features mermaid-quickjs test_mindmap_edge_overlap_padding_present`
- `python tools/mermaid_review_pack.py --case mindmap --output tests/mermaid_visual/review_pack/2026.01.10-mindmap`

## Mindmap Results
- Mindmap diff remains within threshold (7.80%) and edges now meet node borders visually.
