# Journal - Code Review Follow-ups

Date: 2025.12.31

## Entry 1
- Start follow-up fixes from code review report.
- Target items: mermaid placeholder handling, image decode size limits, image cache stale behavior, tooling cleanup (mermaid visual crop/monitor sizing, Kroki env drift), font name collision handling, stale backup test file removal.

## Entry 2
- Updated mermaid placeholder handling to render source inline and return true, avoiding double-render fallback.

## Entry 3
- Added raster image size limits and unified decode path for disk images.
- Treat missing image files as stale and extended cache staleness test.

## Entry 4
- Updated mermaid visual diff crop logic and added monitor sizing guard.
- Removed unused Kroki env flag in regression runner and unused manifest field.
- Added font name deduplication in test-font loading.
- Removed stale navigation_tests_backup.rs.

## Entry 5
- Removed Kroki references from CLAUDE.md and documented embedded Mermaid env vars.

## Entry 6
- Updated mermaid renderer test expectations after placeholder behavior change.
- Ran `cargo test --lib` (pass).

## Entry 7
- Addressed clippy field-reassign-with-default in tests (app.rs, mermaid_renderer.rs).
- Ran `cargo clippy --all-targets -- -D warnings` (pass).

## Entry 8
- Ran `cargo test` (pass).

## Entry 9
- Tried mermaid visual diff harness; initial failures due to missing npx and regex bug.
- Fixed mermaid block regex, npx.ps1 handling, delay arg formatting, and added solid-capture detection.
- Built release with mermaid-quickjs (needed patch.exe from Git); fixed shadowed code variable.
- mdscreensnap captures solid black images in this environment, so report marks cases as actual_capture_solid.
