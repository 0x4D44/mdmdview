# Journal: Table Column Alignment Regression
Date: 2025.12.28

## 15:18 - Investigation and Fix

**Observations:**
- Rightmost column missing in `tests/regression/cases/026-table-first-column-align.md` screenshot.
- Table content collapsed to the left, suggesting the last column was starved of width.

**Hypothesis:**
- The remainder-column swap logic in `render_table_tablebuilder` moved the remainder away from the last column.
- egui_extras expects remainder columns to be last; columns after remainder can collapse to near-zero width.

**Changes Made:**
- `src/markdown_renderer.rs`: removed the remainder-column swap logic to keep column policies in-place.

**Validation:**
- `cargo run -- --screenshot tests\regression\cases\026-table-first-column-align.md --output tools\tmp_table_first_col_align.png`
  - Rightmost column now renders in the alignment tables.

## 19:44 - Fix Hscroll Estimation for Remainder Columns

**Observations:**
- Right aligned "Right" column text not visible in 011-table-alignments when the table wrap overhaul path chose horizontal scrolling.
- Debug logging showed resolved widths for remainder columns ballooned to leftover width, inflating desired_total_width.

**Root Cause:**
- estimate_table_total_width used stored resolved widths wholesale, including remainder columns that reflect layout leftovers, which forced use_hscroll and pushed the right column off-screen.

**Changes Made:**
- src/markdown_renderer.rs: compute estimated widths per-column; ignore stored widths for ColumnPolicy::Remainder and clamp resizable/auto to sensible fallbacks.
- src/markdown_renderer.rs: remove temporary debug drawing/logging in render_table_tablebuilder, render_overhauled_cell, and paint_table_text_job.

**Validation:**
- Not run in this step; re-screenshot the alignment cases to confirm right column visibility.

## 22:26 - Restore Remainder Policy Placement to Fix Alignment Regression

**Observations:**
- Alignment tables (005, 011) showed Center columns squeezed left while Right columns took most of the width.
- Wide and line-break tables showed noticeable layout shifts vs baseline.

**Root Cause:**
- `render_table_tablebuilder` forced the remainder policy onto the last column, overriding `derive_column_specs`.
- When the center column was selected as remainder, the swap moved that width to the right column, collapsing the center alignment.

**Changes Made:**
- `src/markdown_renderer.rs`: removed the remainder-policy swap logic to preserve the column policies chosen by `derive_column_specs`.

**Validation:**
- `cargo run -- --screenshot tests\\regression\\cases\\011-table-alignments.md --output tools\\tmp_case_011-table-alignments.png`
- `cargo run -- --screenshot tests\\regression\\cases\\005-tables.md --output tools\\tmp_case_005-tables.png`
- `cargo run -- --screenshot tests\\regression\\cases\\016-table-wide.md --output tools\\tmp_case_016-table-wide.png`
- `cargo run -- --screenshot tests\\regression\\cases\\017-table-line-breaks.md --output tools\\tmp_case_017-table-line-breaks.png`
- `cargo run -- --screenshot tests\\regression\\cases\\026-table-first-column-align.md --output tools\\tmp_case_026-table-first-column-align.png`
