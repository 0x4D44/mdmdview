# Journal: Table Divider Width Fix

**Date:** 2025-11-28
**Branch:** feat/table-dividers

---

## Summary

Fixed a bug where table dividers were drawn at incorrect positions because column widths were captured from the wrong source.

## Root Cause

The `render_table_tablebuilder()` function was capturing column widths from `ui.min_rect().width()` during header rendering. This returns the **cell content width** (the bounding box of the rendered text), not the **allocated column width**.

The correct approach is to use `TableBody::widths()` which returns the actual column widths allocated by the table layout system.

### Before (Buggy):
```rust
header.col(|ui| {
    // ...
    column_widths[ci] = ui.min_rect().width();  // WRONG: captures content width
});
```

### After (Fixed):
```rust
.body(|body| {
    // Capture actual column widths from table layout
    *column_widths.borrow_mut() = body.widths().to_vec();  // CORRECT
    // ...
});
```

## Changes Made

1. **Width capture moved to body closure**
   - Changed `column_widths` from `Vec<f32>` to `RefCell<Vec<f32>>` to allow mutation in nested closure
   - Added `body.widths().to_vec()` call at start of body closure
   - Removed incorrect `ui.min_rect().width()` capture from header callback

2. **Documentation added**
   - Added doc comment to `paint_table_dividers()` explaining correct width source
   - Added inline comments explaining the fix

3. **Clippy warnings fixed**
   - Removed empty lines after doc comments in `sample_files.rs`
   - Fixed unused enumerate index in `elements_to_plain_text()`

## Files Modified

- `src/markdown_renderer.rs` - Main fix for width capture
- `src/sample_files.rs` - Clippy warning fixes

## Testing

- All 90 unit tests pass
- Clippy clean
- Release build successful
- Visual verification needed with `examples/regressions/table-wrap.md` and `table-threat-model.md`

## References

- Design: `wrk_docs/2025.11.28 - HLD - Table Rendering Bug Fixes.md`
- Plan: `wrk_docs/2025.11.28 - PLN - Table Rendering Bug Fixes.md`
- API Docs: https://docs.rs/egui_extras/latest/egui_extras/struct.TableBody.html#method.widths
- Related GitHub Issues: emilk/egui#4783, emilk/egui#4158
