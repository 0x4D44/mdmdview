# 2026.01.20 - JRN - scroll-bug

- Started investigating scroll jump issue with large tables in markdown file.
- Feeling focused but wary of the UI scroll logic; need to reproduce carefully.
- Identified likely cause: row height estimation skipped for wrapped table text, leading to undercounted table height and scroll jumps.
- Implemented broader initial row height estimation for small tables and added a regression test for wrapped rows.
- Feeling cautiously optimistic; still a bit uneasy about screenshot tooling not showing content.
- cargo test initially failed on mermaid_renderer::tests::test_mermaid_worker_init_error_stages; reran full suite and it passed.
- Long test run but stable on retry; feeling relieved, slight concern about flaky test.
- Applied new table row width estimation that allocates remainder columns based on available width; added a unit test for remainder distribution.
- Feeling uneasy about the scroll bug but hopeful this aligns estimates with actual layout to stop jumps.
- Added helper/test for remainder width estimation; clippy/test passes (long run). Feeling a bit worn by long tests but relieved no failures.

## 2026.01.21 - Follow-up Fix

- Identified the actual root cause: estimated row heights were being stored in a local vector, but only rendered rows got their heights cached via `update_row_height`. On frame 2+, `needs_estimate` was false (because some rows existed in cache), so non-rendered rows reverted to fallback heights.
- Fix: Cache estimated heights immediately after calculation in the estimation loop (markdown_renderer.rs:4133). This ensures ALL rows have accurate height hints in the cache, not just the ones that happened to be visible on the first frame.
- All 166 table-related tests pass.
- This should fix the "scroll jumps from top to bottom" issue reported with large audit documents where tables are partially off-screen when first rendered.
