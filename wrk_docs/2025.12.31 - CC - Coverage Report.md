# Code Coverage Report (Baseline)

## Data sources
- `wrk_docs/coverage-current-summary.json` (llvm-cov summary export)
- `wrk_docs/coverage-current-missing.txt` (llvm-cov missing-lines view)

## Overall metrics
- **All files (including generated bindings under `target/llvm-cov-target`)**: 7180/8232 lines covered = **87.22%**.
- **First-party `src/` only**: 7180/7988 lines covered = **89.88%**.
- **First-party `src/` function coverage**: 612/647 = **94.59%**.
- **First-party `src/` region coverage**: 11819/13321 = **88.72%**.

## Per-file coverage (first-party `src/`)
| File | Lines | Line % | Function % | Region % |
| --- | ---: | ---: | ---: | ---: |
| `src\table_support\column_spec.rs` | 419/505 | 82.97% | 92.86% | 86.02% |
| `src\window_state.rs` | 135/159 | 84.91% | 93.75% | 83.27% |
| `src\markdown_renderer.rs` | 3519/4043 | 87.04% | 94.55% | 85.81% |
| `src\app.rs` | 2500/2673 | 93.53% | 94.04% | 91.91% |
| `src\main.rs` | 101/102 | 99.02% | 87.50% | 98.56% |
| `src\emoji_assets.rs` | 159/159 | 100.00% | 100.00% | 98.18% |
| `src\emoji_catalog.rs` | 139/139 | 100.00% | 100.00% | 100.00% |
| `src\sample_files.rs` | 51/51 | 100.00% | 100.00% | 96.77% |
| `src\table_support\metrics.rs` | 157/157 | 100.00% | 100.00% | 99.26% |

## Key observations
1. **Generated bindings depress totals**: two `target/llvm-cov-target/.../bindings.rs` files contribute **244 lines at 0% coverage**, lowering the overall metric to 87.22%. These are third-party artifacts rather than first-party logic.
2. **Largest coverage gap is `src/markdown_renderer.rs`**: it is the largest file (4043 lines) and currently at 87.04% lines. Raising this file alone by ~10 points would materially move overall coverage.
3. **`src/table_support/column_spec.rs` and `src/window_state.rs` are under 85%**: these are pure-logic modules with deterministic inputs and should be easier to push above 95% via targeted unit tests.
4. **`src/app.rs` is relatively high but still missing edge paths**: remaining gaps cluster around UI-driven branches (search navigation, raw editor state, drag-and-drop queue handling, and window-state persistence paths).
5. **`src/main.rs` is nearly fully covered**: only the `main()` stub and a small number of branches are missing.

## Gap analysis (by module)

### `src/markdown_renderer.rs` (87.04% lines)
- **Uncovered branches in rendering paths**: several branches in inline rendering and layout are not exercised by tests, likely including rarer inline spans (images + alt text, emoji shortcode expansion, link hover/click behavior, and error fallbacks).
- **Table rendering and layout**: the table layout logic contains multiple branches for column sizing, wrapping, and overflow handling that are not fully exercised by the current test cases.
- **Image and SVG handling**: error paths for failed image decoding, missing assets, and SVG rasterization appear under-tested.
- **Anchor and link handling**: anchor normalization and in-document navigation appear to have limited coverage, especially around edge cases (duplicate headings, empty anchors, or non-ASCII). 

### `src/table_support/column_spec.rs` (82.97% lines)
- **Policy classification branches**: `ColumnPolicy::Fixed`/`Resizable` branches with different `clip` values, remainder cap enforcement, and ?fallback? remainder selection are not fully covered.
- **Rich content detection**: spans that include images, links, and emoji-like characters should be covered together to ensure max-width calculations and flags are exercised.
- **Tooltip formatting**: branch coverage for tooltip text variants (clipped vs non-clipped) can be improved.

### `src/window_state.rs` (84.91% lines)
- **Environment fallback paths**: `XDG_CONFIG_HOME` vs `HOME` vs `APPDATA` fallback combinations are partially covered.
- **File I/O error paths**: malformed state file handling and missing file paths exist but not all branches are exercised.
- **Windows registry paths**: registry load/save logic is compiled only for non-test Windows builds, and remains untested.

### `src/app.rs` (93.53% lines)
- **Search navigation**: edge paths for empty query, wrap-around, and no matches are only partially covered.
- **Raw editor cursor management**: cursor persistence and movement branches are under-covered.
- **Drag-and-drop queue**: queue overflow/ordering and folder-drop paths could use explicit tests.
- **Window state persistence**: debounce logic and error handling for persistence appear lightly exercised.

## Risks
- **Renderer regressions**: `markdown_renderer.rs` is central and large. Gaps here increase risk of rendering regressions, especially in tables, images, and anchors.
- **State persistence**: under-tested window state handling can lead to hard-to-debug UX failures (restoring invalid positions, corrupted state files).

## Recommendations
- Prioritize test coverage in **`markdown_renderer.rs`**, **`column_spec.rs`**, and **`window_state.rs`**.
- Add targeted unit tests for edge paths rather than only increasing scenario breadth.
- Exclude generated target bindings from coverage metrics for a cleaner signal, while keeping first-party coverage improvements as the primary goal.
