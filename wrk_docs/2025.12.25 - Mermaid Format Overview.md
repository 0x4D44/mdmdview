# Mermaid format overview

Date: 2025.12.25

## What a Mermaid file is
Mermaid diagrams are text descriptions that render into SVG diagrams. A Mermaid source file is typically:
- A dedicated text file with .mmd or .mermaid extension, or
- A fenced Markdown code block using ```mermaid.

Mermaid renders the diagram by parsing the first non-frontmatter line as a diagram type keyword, then interpreting the remaining lines as that diagram's syntax.

## File structure and parsing rules
1. Optional YAML frontmatter block (--- ... ---). This config is applied to the diagram (v10.5.0+).
2. Diagram type declaration (flowchart, sequenceDiagram, classDiagram, etc).
3. Diagram body (diagram-specific grammar).

Comments are full lines that start with %% and continue to end of line. Unknown tokens can break parsing or be silently ignored depending on context. Some diagrams have known reserved words (for example, "end" in flowcharts and sequences).

## Configuration and directives
Configuration sources, in order of application:
- Default config.
- Site config (mermaid.initialize), used by the host application.
- Frontmatter config (YAML at the top of a diagram).
- Directives (%%{init: ...}%%) inside the diagram. Directives are deprecated in favor of frontmatter.

Frontmatter example:
---
config:
  theme: base
  themeVariables:
    primaryColor: "#00ff00"
---
flowchart
  A --> B

Directive example (deprecated):
%%{init: { "theme": "dark", "flowchart": { "curve": "linear" } }}%%
flowchart LR
  A --> B

## Security, HTML, and interactivity
Mermaid sanitizes output based on securityLevel:
- strict (default): HTML labels and click interactions disabled.
- antiscript / loose: HTML labels allowed, click interactions enabled.
- sandbox: render in iframe (restricts interactions).

Interactive features (click links, callbacks, menus) require a non-strict securityLevel.

## Common features across diagrams
- Styling: style, classDef, class, and ::: shorthand (diagram dependent).
- Links and click callbacks in some diagrams (flowchart, class, gantt, etc).
- Accessibility: accTitle and accDescr add SVG <title>/<desc> with aria attributes.
- Themes: default, neutral, dark, forest, base (only base is customizable).
- Layout: dagre (default), elk, tidy-tree, cose-bilkent (diagram support varies).
- Math: $$...$$ (supported in flowchart and sequence; requires KaTeX integration).
- Icon support: icon packs can be registered and used in flowcharts, mindmaps, architecture, etc.

## Diagram types and syntax notes
Below is a compact catalog of diagram keywords, status, and key syntax.

### Flowchart / Graph (stable)
Keyword: flowchart or graph
- Direction: TB, TD, BT, RL, LR.
- Nodes: bracket shapes like [rect], (round), {diamond}, ((circle)), etc.
- Edges: -->, ---, -.->, ==>, ~~~, --o, --x, with labels.
- Subgraph: subgraph name ... end.
- Styling: style, classDef, class, :::. Edge styling via linkStyle.
- Interaction: click nodeId callback or URL (securityLevel != strict).
- Newer node shapes: A@{ shape: rect, label: "..." } and icon/image shapes.

### Sequence diagram (stable)
Keyword: sequenceDiagram
- Participants: implicit or participant/actor. Types via @{ "type": "boundary" | "control" | "entity" | "database" | "collections" | "queue" }.
- Messages: ->>, -->>, ->, --, -x, --x, -), --) and variants.
- Activations: activate/deactivate or arrow suffix + / -.
- Notes: Note left of/right of/over.
- Control blocks: loop, alt/else, opt, par/and, critical/option, break, rect.
- Create/destroy participants: create participant, destroy participant.
- Autonumber: autonumber.
- Actor menus: link/links definitions.

### Class diagram (stable)
Keyword: classDiagram
- Classes: class Name or via relationships.
- Members: Name : +field or class Name { ... } (methods have ()).
- Visibility: + public, - private, # protected, ~ package.
- Relationships: <|--, *--, o--, -->, --, ..>, ..|>, .. (labels optional).
- Multiplicity: quoted labels near relationships.
- Namespace: namespace Foo { ... }.
- Notes: note "..." and note for Class "...".
- Styling: style, classDef, class, :::.

### State diagram (stable)
Keywords: stateDiagram-v2 (preferred), stateDiagram (legacy)
- States: id, state "Description" as id, or id : Description.
- Transitions: --> with optional labels.
- Start/end: [*] --> state, state --> [*].
- Composite states: state X { ... } with nested [*].
- Choice: <<choice>>. Fork/join: <<fork>> / <<join>>.
- Concurrency: -- separator inside composite state.
- Styling: classDef + class / ::: (limitations apply).

### Entity relationship diagram (stable)
Keyword: erDiagram
- Relationships: ENTITY ||--o{ ENTITY : label (crow's foot notation).
- Identifying vs non-identifying: -- vs .. line.
- Attributes: Entity { type name } with optional PK/FK/UK and "comment".
- Entity label: Entity[Label].
- Direction: direction LR/TB/etc.

### User journey (stable)
Keyword: journey
- title optional.
- Sections: section Name.
- Tasks: Task name: score: Actor1, Actor2 (score 1-5).

### Gantt (stable)
Keyword: gantt
- title, dateFormat, axisFormat, tickInterval, weekday, excludes.
- section Name blocks.
- Tasks: Title : [tags], [id], [start], [end or duration]; tags include active, done, crit, milestone.
- Dependencies: after <taskId>, until <taskId>.
- displayMode: compact via frontmatter.
- Interaction: click taskId call/href.

### Pie (stable)
Keyword: pie (optional showData)
- title optional.
- Data: "Label" : value (positive numbers only).

### Quadrant chart (stable)
Keyword: quadrantChart
- title, x-axis left --> right, y-axis bottom --> top.
- quadrant-1..4 labels.
- Points: Label: [x, y] where x and y are 0..1.
- Point styles: color, radius, stroke-color, stroke-width.

### Requirement diagram (stable)
Keyword: requirementDiagram
- Requirement blocks: requirement/functionalRequirement/interfaceRequirement/performanceRequirement/physicalRequirement/designConstraint.
- Fields: id, text, risk (Low/Medium/High), verifymethod (Analysis/Inspection/Test/Demonstration).
- Element blocks: element name { type: ..., docref: ... }.
- Relationships: source - satisfies -> dest (contains, copies, derives, satisfies, verifies, refines, traces).
- Direction: direction LR/TB/etc.

### Git graph (stable)
Keyword: gitGraph (optionally LR:, TB:, BT:)
- Commands: commit, branch, checkout (or switch), merge, cherry-pick.
- Commit attributes: id, tag, type (NORMAL, REVERSE, HIGHLIGHT).
- Config: showBranches, showCommitLabel, mainBranchName, mainBranchOrder, rotateCommitLabel, parallelCommits.

### C4 (experimental)
Keywords: C4Context, C4Container, C4Component, C4Dynamic, C4Deployment
- PlantUML-compatible elements: Person, System, Container, Component, Boundary, etc.
- Relationships: Rel, BiRel, Rel_U/Rel_D/Rel_L/Rel_R, Rel_Back, RelIndex.
- Styling: UpdateElementStyle, UpdateRelStyle. Layout: UpdateLayoutConfig.
- Layout is order-dependent (not fully automatic); some features unsupported.

### Mindmap (experimental)
Keyword: mindmap
- Indentation defines hierarchy.
- Shapes like flowchart brackets and parentheses.
- Icons: ::icon(pack icon) requires icon pack registration.
- Classes: :::class1 class2.
- Markdown strings with backticks.

### Timeline (experimental)
Keyword: timeline
- title optional. Entries: time : event (multiple events per time).
- section Name for grouping.
- disableMulticolor to use a single palette.

### Sankey (experimental)
Keyword: sankey
- CSV-like lines: source,target,value (3 columns only).
- Empty lines allowed. Quotes required for commas; "" to escape quotes.
- Config: width, height, linkColor (source/target/gradient/hex), nodeAlignment.

### XY chart (stable)
Keyword: xychart (optional horizontal)
- title, x-axis (categories or numeric range), y-axis numeric range.
- bar [values] and line [values].
- Config: size, axis options, showDataLabel. Theme variables for axes and plots.

### Block diagram (stable)
Keyword: block
- columns N to set grid. Blocks can span columns with id:N.
- Nested blocks: block:ID ... end. space and space:N placeholders.
- Block arrows: blockArrowId<["label"]>(direction).
- Edges: -->, ---, with labels. Styling: style, classDef.

### Packet diagram (stable)
Keyword: packet
- Fields: start-end: "Label" or +N: "Label" for bit counts. Single-bit uses start: "Label".
- Optional title line.

### Kanban (stable)
Keyword: kanban
- Columns: columnId[Title]. Tasks are indented beneath columns.
- Task metadata: @{ ticket: ..., assigned: ..., priority: "High" } (priority supports Very High/High/Low/Very Low).
- Config: kanban.ticketBaseUrl.

### Architecture diagram (beta)
Keyword: architecture-beta
- Groups: group id(icon)[Label] (optional in parent).
- Services: service id(icon)[Label] (optional in group).
- Edges: serviceId:Side -- Side:serviceId with optional arrows.
- Junctions: junction id.
- Icons: built-in set plus icon packs.

### Radar diagram (beta)
Keyword: radar-beta
- axis lines define axes; curve lines define datasets.
- Curves can use ordered values or axisId: value pairs.
- Options: title, showLegend, min, max, graticule, ticks.

### Treemap (beta)
Keyword: treemap-beta
- Indentation for hierarchy. Parents: "Label". Leaves: "Label": value.
- Styling: classDef and :::.
- Config: padding, diagramPadding, showValues, valueFormat (D3 format strings).

### ZenUML (external)
Keyword: zenuml
- Alternate sequence syntax with method-call style messages and nesting.
- Control flow: if/else, while/for, par, opt, try/catch/finally.
- Comments: // comment.
- Requires external diagram registration (mermaid-zenuml).

## Known pitfalls and compatibility notes
- "end" can break flowchart and sequence diagrams unless wrapped in brackets/quotes.
- %%{}%% inside comments can be misinterpreted as directives.
- Some diagram types are experimental or beta and may change (architecture-beta, radar-beta, treemap-beta, sankey).
- Zenuml and some other diagrams require external registration in web integrations; when embedding Mermaid locally you may need to include those diagram modules.
