# Code Review Report - mdmdview
Date: 2026.01.04

## Scope
Reviewed Rust sources, build script, CLI, rendering pipeline, table subsystem, and Python tooling. Third-party minified Mermaid JS was noted but not audited.

## Findings (ordered by severity)

### Medium
- Unbounded image texture cache and no negative caching for failures can cause repeated disk reads and unbounded memory growth when documents contain many images or broken paths. `src/markdown_renderer.rs:281` `src/markdown_renderer.rs:4860`
  - Impact: frame-time spikes and memory growth on large docs or repeated missing image references.
  - Recommendation: add an LRU cap and store failed-load results with a timestamp/backoff.

- Large file/image operations run synchronously on the UI thread (file reads + parsing + image decoding), which can freeze the UI for big inputs. `src/app.rs:723` `src/app.rs:764` `src/markdown_renderer.rs:4860`
  - Impact: visible stalls when opening large files or rendering many/large images.
  - Recommendation: consider background loading/decoding with a placeholder UI and staged updates.

### Low
- Link styling treats `www.` URLs as external, but click handling only allows `http/https/mailto`. This results in links that look clickable but are blocked. `src/markdown_renderer.rs:2584` `src/markdown_renderer.rs:2685` `src/markdown_renderer.rs:4707` `src/markdown_renderer.rs:4717`
  - Impact: confusing UX for `www.example.com` autolinks.
  - Recommendation: normalize `www.*` to `https://` on click or allow it in `is_allowed_scheme`.

- Window position clamping forces non-negative coordinates and registry persistence clamps to unsigned values, which breaks multi-monitor setups where a window can legitimately be at negative X/Y. `src/window_state.rs:123` `src/window_state.rs:165`
  - Impact: window jumps back to primary monitor on relaunch in some multi-monitor layouts.
  - Recommendation: store signed positions and clamp against monitor bounds instead of zero.

- Cell layout cache eviction behaves like FIFO (no touch-on-read), so frequently used entries can be evicted early. `src/markdown_renderer.rs:181`
  - Impact: reduced cache hit rate and avoidable re-layout work on large tables.
  - Recommendation: update cache order on `get` to make it true LRU.

## Additional Observations
- `assets/vendor/mermaid.min.js` is minified third-party code; no deep review performed. Ensure provenance and license tracking.

## Test Coverage & Recommendations
- Add a UI test for `www.*` links to confirm they open as expected.
- Add stress tests for many/missing images to exercise caching and failure backoff.
- Add a multi-monitor window-restore test (negative positions) if you adjust window state handling.
- Consider a performance/regression test for large-file load to detect UI stalls.

## Assumptions / Open Questions
- Assumed single-threaded UI usage for `MarkdownRenderer` and `MermaidRenderer` state (RefCell usage).
- Assumed `www.*` links are intended to be supported as clickable URLs.
