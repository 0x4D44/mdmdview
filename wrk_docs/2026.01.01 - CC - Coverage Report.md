# Code Coverage Report - 2026.01.01

## Scope and Commands
- Coverage tool: `cargo llvm-cov 0.6.21`.
- Command: `cargo llvm-cov --workspace --all-targets --json --output-path wrk_docs/coverage-latest.json --ignore-filename-regex "target/llvm-cov-target"`.
- Missing lines view: `cargo llvm-cov --workspace --all-targets --text --show-missing-lines --output-path wrk_docs/coverage-latest-missing.txt --ignore-filename-regex "target/llvm-cov-target"`.
- Notes: Default features only (no `mermaid-quickjs` feature enabled). Generated bindings under `target/llvm-cov-target` are excluded.

## Overall Coverage (src-only)
- Line coverage: 84.15% (9013 / 10711).

## Per-file Line Coverage (src)
| File | Lines | Covered | Coverage |
| --- | --- | --- | --- |
| `app.rs` | 2372 | 1422 | 59.95% |
| `main.rs` | 223 | 192 | 86.10% |
| `markdown_renderer.rs` | 6126 | 5493 | 89.67% |
| `table_support/column_spec.rs` | 747 | 696 | 93.17% |
| `mermaid_renderer.rs` | 341 | 319 | 93.55% |
| `image_decode.rs` | 143 | 138 | 96.50% |
| `sample_files.rs` | 60 | 58 | 96.67% |
| `window_state.rs` | 223 | 219 | 98.21% |
| `emoji_assets.rs` | 159 | 159 | 100.00% |
| `emoji_catalog.rs` | 139 | 139 | 100.00% |
| `table_support/metrics.rs` | 178 | 178 | 100.00% |

## Coverage Gaps (Highest Risk)
- `src/app.rs` (59.95%): Large, untested branches in screenshot automation, UI event handling, keyboard shortcuts, drag-and-drop edge paths, and window persistence flows. These areas are central to the runtime behavior and should be prioritized.
- `src/markdown_renderer.rs` (89.67%): Many untested branches in rendering paths (inline span rendering, code block variants, table rendering branches, link handling), leading to regression risk in core rendering.
- `src/main.rs` (86.10%): CLI argument parsing and screenshot mode entry points have partial coverage only.

## Test Pyramid Assessment
- Unit tests are present and extensive in rendering and table modules, but coverage is skewed away from app-level logic.
- Integration-style coverage is thin for UI flows (render/update loop, screenshot workflow, window state persistence). These are high-value, high-risk paths.

## Quality Notes
- Tests appear deterministic and fast; coverage gaps are largely in UI and automation paths rather than in pure utility logic.
- The missing-lines report shows broad untested spans rather than isolated branches, indicating missing behavioral tests rather than edge-case assertions.

## Recommendations (Short-Term)
1. **App coverage push**: Add targeted tests for screenshot lifecycle, keyboard shortcuts, navigation history, and error paths in file handling.
2. **Renderer branch coverage**: Add focused unit tests for untested render branches, especially inline span variants, code blocks, and list/table rendering options.
3. **CLI coverage**: Exercise CLI flags for screenshot and theme selection to cover `main.rs` branches.
4. **Coverage hygiene**: Keep `--ignore-filename-regex "target/llvm-cov-target"` to avoid generated bindings inflating totals.

## Appendix
- Coverage artifacts: `wrk_docs/coverage-latest.json`, `wrk_docs/coverage-latest-missing.txt`, `wrk_docs/coverage-latest-summary.json`.
