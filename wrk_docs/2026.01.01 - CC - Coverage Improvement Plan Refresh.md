# Coverage Improvement Plan (2026.01.01)

## Target
- Maintain line coverage >= 98% with default features enabled.

## Stage 0 - Baseline and Tooling
- Re-run coverage with default features once `patch` is available on PATH for QuickJS builds.
- Keep `wrk_docs/coverage-latest.json`, `wrk_docs/coverage-latest-summary.json`, and `wrk_docs/coverage-latest-missing.txt` updated after each stage.

## Stage 1 - Quick Line Wins (Low Effort)
- Add tests for small uncovered branches in `src/window_state.rs`, `src/table_support/column_spec.rs`, and `src/main.rs`.
- Goal: reduce the easy misses and stabilize coverage above 98%.

## Stage 2 - Mermaid Renderer Paths
- Add unit tests for `src/mermaid_renderer.rs` missing lines (245, 253, 335, 506, 767, 865, 2852, 2971).
- Run `cargo test --features mermaid-embedded` after `patch` is available to cover embedded QuickJS paths.

## Stage 3 - Markdown Renderer Hotspots
- Target missing line clusters in `src/markdown_renderer.rs`:
  - 800-899: inline span parsing and HTML break paths.
  - 2700-2799, 3300-3499: table layout branches and tablebuilder fallbacks.
  - 4000-4099, 5600-5699: render-time edge cases (images, links, empty spans).
- Add focused fixtures and tests for each cluster.

## Stage 4 - App UI Edge Cases
- Expand `src/app.rs` tests around the 1000-1099 and 1800-2199 clusters:
  - screenshot state transitions, raw edit toggles, navigation with error states.

## Stage 5 - Verify and Lock In
- Re-run coverage (default features) and confirm the line coverage remains >= 98%.
- Update the report and keep a short delta log of coverage improvements.

## Implementation Status (This Pass)
- Stage 1 started: new tests added in `src/table_support/column_spec.rs` and `src/window_state.rs`; coverage re-run with `--no-default-features` now at 98.09% lines.
- Remaining: Stage 1 still includes `src/main.rs` line 102 and `src/image_decode.rs` line 58 (harder-to-hit guards), plus stages 2-5.
