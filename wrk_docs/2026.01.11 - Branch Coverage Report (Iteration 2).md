# 2026.01.11 - Branch Coverage Report (Iteration 2)

## Command
- `cargo +nightly llvm-cov --branch`
- Note: build requires Git `patch.exe` on PATH (`C:\Program Files\Git\usr\bin`).

## Summary
- Total branch coverage: **80.73%** (2335 branches, 450 missed).
- Total line coverage: **94.85%** (16828 lines, 866 missed).
- Total region coverage: **92.63%** (27928 regions, 2059 missed).
- Warning: `cargo-llvm-cov` reports **1 functions have mismatched data**.

## Coverage Hotspots (Branch)
- `src/mermaid_renderer.rs`: 67.92% (477 branches, 153 missed).
- `src/markdown_renderer.rs`: 82.49% (988 branches, 173 missed).
- `src/app.rs`: 85.66% (572 branches, 82 missed).
- `src/emoji_assets.rs`: 73.53% (34 branches, 9 missed).
- `src/window_state.rs`: 85.71% (28 branches, 4 missed).

## Generated Bindings
- `target/llvm-cov-target/.../egl_bindings.rs`: 0% (6 branches).
- `target/llvm-cov-target/.../wgl_extra_bindings.rs`: 0% (6 branches).

## Key Changes Since Baseline
- Added targeted tests for:
  - Mermaid LRU cache variants and QuickJS exception formatting.
  - Markdown list marker punctuation, image retry backoff, table rect extension, and code-block rendering without language.
  - App async file loading paths, file-load polling mismatch/lossy cases, screenshot crop saving, and save persistence behavior.
- Adjusted a brittle screenshot scroll assertion and removed an always-true assertion in app tests.
- Updated coverage JSON at `wrk_docs/coverage.json`.

## Notes
- Full coverage run completes in ~5 minutes on this machine.
- Long-running tests log “running over 60 seconds” but complete successfully.

## Next Focus Areas (to approach >90% branch)
1. `src/mermaid_renderer.rs` missing branches in LruCache, rasterization, and QuickJS error formatting variants.
2. `src/markdown_renderer.rs` remaining branch gaps around table layout conditions and list/table parsing edge cases.
3. `src/app.rs` UI-driven branches (search dialog, viewport adjustments) that need input simulation.
4. Small modules (`emoji_assets.rs`, `window_state.rs`, `column_spec.rs`, `image_decode.rs`) for low-effort branch cleanup.
