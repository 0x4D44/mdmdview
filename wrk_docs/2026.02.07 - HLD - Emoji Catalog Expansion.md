# HLD: Emoji Catalog Expansion

**Date:** 2026-02-07
**Status:** Implementation

## Summary

Expand the emoji catalog from 18 to ~80 emojis with Twemoji PNG assets, add ~70 shortcodes, and fix the FE0F variation selector fallback bug.

## Motivation

The current catalog covers only 18 emojis (party, check, rocket, faces, etc.). Many commonly used emojis in technical documentation â€” warning signs, arrows, status indicators, dev tools â€” render as system font glyphs or grey circle placeholders instead of color Twemoji art.

Additionally, the FE0F (VS16) fallback in `emoji_key_for_grapheme()` unconditionally returns `Some` for any grapheme containing the variation selector, even when we have no art for it. This produces grey circle placeholders for uncatalogued emojis instead of letting the system font render them.

## Design

### New Emojis (62 additions)

All sourced from Twemoji 72x72 PNGs (~500-1500 bytes each, ~50KB total).

| Category | Count | Examples |
|---|---|---|
| Status/Indicators | 9 | âš  âŒ âœ¨ ğŸ’¯ â³ ğŸ”„ âœ” â ğŸš« |
| Objects/Tools | 14 | ğŸ”— ğŸ“‹ ğŸ“ ğŸ“‚ ğŸ”’ ğŸ”“ âš™ ğŸ” ğŸ“Š ğŸ“ˆ ğŸ“‰ ğŸ“Œ ğŸ”¨ âœ |
| Arrows | 4 | â¡ â¬† â¬‡ â¬… |
| Communication | 3 | ğŸ’¬ ğŸ“¢ ğŸ“§ |
| Nature/Symbols | 8 | â¤ ğŸ’ ğŸŒŸ ğŸ¯ ğŸ¨ ğŸ›¡ ğŸŒŠ âš¡ |
| People/Faces | 5 | ğŸ‘€ ğŸ¤” ğŸ‘‹ ğŸ™ ğŸ’ª |
| Dev/Tech | 6 | ğŸ› ğŸš§ ğŸ— ğŸ’» ğŸ–¥ âŒ¨ |
| Misc | 13 | ğŸ† ğŸª ğŸ“– ğŸ“š ğŸ”” ğŸ”• ğŸ—‚ â„¹ ğŸ”´ ğŸŸ¢ ğŸŸ¡ ğŸ”µ â˜‘ |

### Shortcode Additions (~70 new)

Standard GitHub/Slack shortcode names mapped to their Unicode codepoints. Includes aliases like `:+1:` â†’ ğŸ‘, `:-1:` â†’ ğŸ‘.

### FE0F Bug Fix

**Problem:** `emoji_key_for_grapheme()` line 3302-3304 returns `Some(stripped)` for ANY grapheme containing FE0F, even if there's no catalog art or procedural fallback. This produces grey circle placeholders.

**Fix:** After stripping FE0F and checking the catalog (already done above the bug), also check `emoji_assets::has_fallback()`. If neither the catalog nor the fallback has art, return `None` to let the system font render it naturally.

### New `has_fallback()` function

Added to `emoji_assets.rs` as a lightweight check that avoids allocating a `ColorImage` just to test existence.

## Files Modified

- `assets/emoji/*.png` â€” 62 new PNG files
- `src/emoji_catalog.rs` â€” `image_bytes_for()`, `shortcode_map()`, tests
- `src/markdown_renderer.rs` â€” `emoji_key_for_grapheme()`, `generate_emoji_image()`, `is_known_emoji()`
- `src/emoji_assets.rs` â€” add `has_fallback()`
- `Cargo.toml` â€” version bump to 1.3.4

## Risk Assessment

- **Low risk**: Additive changes only, no existing behavior modified except the FE0F fix
- **FE0F fix**: Uncatalogued FE0F emojis now fall to font instead of grey circle (correct behavior)
- **Binary size**: ~50KB increase (negligible)
