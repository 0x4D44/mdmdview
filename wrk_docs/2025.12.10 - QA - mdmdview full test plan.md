# mdmdview Full Functional Test Plan (2025-12-10)

## 1. Objectives
- Validate the shipping Windows build of mdmdview against core reader scenarios using egui UI automation via `mduitestmcp`.
- Confirm no regressions in rendering (markdown, tables, images), interaction (keyboard/mouse shortcuts), and persistence (history, zoom, fullscreen) when running the 2025-12-10 commit.
- Capture reproducible evidence (screenshots, notes, logs) for every failure to feed the defect report.

## 2. Scope
In scope:
- Desktop build `target\\release\\mdmdview.exe` launched on Windows 11.
- Rendering of bundled docs (`README.md`, `examples/*.md`, `examples/regressions/*.md`).
- File operations: CLI arg, File > Open dialog, Samples submenu, drag & drop proxy check via clipboard path paste if direct drag simulation fails.
- UI chrome: menu bar, status bar, search panel, table wrap toggle, raw/edit mode, zoom/fullscreen, navigation history, queue indicator.
- Error handling for nonexistent paths and locked/unreadable files.
Out of scope:
- Linux/macOS specific behaviors.
- Kroki/QuickJS network rendering (feature-disabled in default build).

## 3. Test Environment & Tooling
- Hardware: Windows VM provided by Codex CLI with display access.
- Build: run `cargo build --release` before testing to ensure assets are current.
- Automation: `mduitestmcp` MCP (functions: `ui_capture_once`, `ui_keyboard_input`, `ui_mouse_move`, `ui_mouse_click`, `ui_mouse_scroll`, `ui_start_periodic`, `ui_stop_periodic`).
- Support commands: PowerShell for launching/stopping the app (`Start-Process`, `Stop-Process`), and `tasklist` for verification.
- Artifacts: screenshots saved by mduitest (automatic), textual notes consolidated in wrk_docs defect report.

## 4. Test Data
| ID | File | Purpose |
|----|------|---------|
| TD1 | `README.md` | Full mix of headings, tables, code, long scroll |
| TD2 | `examples/complete_test.md` | Stress markdown variety |
| TD3 | `examples/regressions/table-threat-model.md` | Table wrap overhaul validation |
| TD4 | `examples/inline_images.md` | Image loading |
| TD5 | `examples/test_file.md` | Small doc for navigation history |
| TD6 | Synthetic missing file path (`missing.md`) | Error handling |

## 5. Execution Approach
1. Build: `cargo build --release`.
2. Launch phases:
   - P0 CLI launch: `target\\release\\mdmdview.exe README.md`.
   - P1 Empty launch: run without args; use File > Open to load TD2.
3. Use mduitest controls to drive scenarios sequentially; mark actual vs expected in the tracker below.
4. Capture screenshot per unique UI defect or important confirmation (zoom indicator, table wrap state, search panel, raw mode, fullscreen, error toast).
5. Between scenarios, reset app state (close file/history) or restart the process to avoid cascading issues.
6. Record timestamps; after completion, stop the app and collect logs (stdout/stderr) from terminal session.

## 6. Detailed Test Cases
| TC | Area | Steps (high level) | Expected Result | Evidence |
|----|------|--------------------|-----------------|----------|
| TC01 | Launch + CLI Arg | Run release exe with TD1; verify window title shows file name, content renders, status bar shows zoom 100% | App opens without dialogs, content scrollable, process id stable | Screenshot of viewport + tasklist snippet |
| TC02 | Basic Scroll/Search | Use Ctrl+F to search "mdmdview", iterate results with Enter/Shift+Enter, verify highlight + count; scroll via mouse wheel | Search panel updates counts; highlight matches; scroll smooth | Video or screenshot showing search panel |
| TC03 | File > Open Dialog | Launch w/out args, use Ctrl+O > navigate to TD2 via clipboard path entry, ensure doc loads | Title updates, queue empty, status bar shows file path | Screenshot |
| TC04 | Samples Menu | File > Samples > select `Test: Complete` (or equivalent) | Embedded sample renders; history push occurs | Screenshot |
| TC05 | Navigation History | After loading TD2 + sample, use Alt+Left/Right to move history; confirm content toggles and status text updates | History icon highlight or content change; no panic | Notes |
| TC06 | Queue / Multiple Files | Drag-drop surrogate: open TD2, then use CLI to open TD2+TD5 sequentially; ensure queue indicator updates and Alt+Quote cycles | Status bar "N files in queue" message shown | Screenshot |
| TC07 | Table Wrap Toggle | Load TD3, open View > Table Wrap (or relevant shortcut), observe column resizing persistence | Column widths change when toggled; setting persists after reopen | Before/after screenshot |
| TC08 | Raw + Edit Mode | Load TD1, press Ctrl+R to switch to raw, then Ctrl+E to enter edit, modify text, exit edit, verify file contents change on disk | Raw view shows plaintext; edit saves; returning to rendered shows change | Git diff or file timestamp |
| TC09 | Zoom Controls | Use Ctrl++ twice, Ctrl+- once, Ctrl+0 to reset; ensure status bar zoom text updates and layout rescales | Zoom indicator matches operations | Screenshot |
| TC10 | Fullscreen | Press F11 to enter/exit; ensure window state persists after restart (close + relaunch) | Window toggles; relaunch starts with last window size/position | Notes |
| TC11 | Reload Current File | Modify TD5 externally (append line) while open; press F5 and ensure content refreshes and scroll offset stable | Latest content shown; notification maybe | Notes |
| TC12 | Error Handling | Launch with nonexistent file, observe toast/dialog; attempt to open locked file (use `Set-Content` while open) | Friendly error message w/out crash | Screenshot |
| TC13 | External Links | Click hyperlink in TD1; ensure OS browser opens once; app remains responsive | Default browser opened (verified via `tasklist`) | Notes |
| TC14 | Performance/Stability | Scroll end-to-end on TD1 for 30 seconds while monitoring CPU/memory via Task Manager | App remains under 25% CPU average, no leaks/crash | Observed metrics |

## 7. Pass/Fail Criteria
- PASS: All test cases executed; critical (launch/blocker) defects resolved or have acceptable workarounds; medium/minor defects documented.
- FAIL: Any crash/hang/data-loss issue remains open or more than 3 medium severity issues logged.

## 8. Reporting
- Track execution notes inline; escalate blocking defects immediately to engineering with reproduction steps + screenshot.
- Compile final defect report (same date naming) summarizing: environment, executed cases, pass/fail counts, defect list, recommendations.

## 9. Schedule
- Plan authoring: 30 minutes (completed 2025-12-10 11:15 EST).
- Execution window: 2025-12-10 11:15–14:00 EST.
- Report delivery: 2025-12-10 14:30 EST.

## 10. Risks & Mitigations
- **Automation drift**: UI element positions may shift; rely on keyboard shortcuts and relative coordinates captured via `ui_capture_once` before actions.
- **File dialog automation**: If native dialog resists automation, fall back to launching with CLI args for equivalent coverage and document deviation.
- **Resource conflicts**: Ensure previous mdmdview instances are terminated before new scenario.
