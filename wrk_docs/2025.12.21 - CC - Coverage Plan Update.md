# Coverage Improvement Plan (Target: 98% Line Coverage)

Goal: Reach >=98% line coverage for repo source (`src/`), excluding generated `target/llvm-cov-target` bindings.

## Stage 1: Small Modules + Deterministic Env (quick wins)
- Add tests in `src/main.rs` to cover the test main stub and the non-dark-mode path in `configure_egui_style`.
- Expand `src/window_state.rs` tests to cover `config_dir` fallbacks (XDG/HOME/None) and `save_window_state` when no config directory is available.
- Add `src/table_support/column_spec.rs` tests for `header_text`, `spans_to_text`, `ColumnPolicy::to_column` variants, `apply_preferred_width` clamping, and `column_tooltip` formatting.
- Verify with `cargo llvm-cov --all --json --summary-only --output-path wrk_docs/coverage-stage1.json`.

## Stage 2: Column Heuristics + App Shortcut Branches
- Add table column heuristic tests to cover `classify_column` branches (date/time/status/notes) and remainder assignment logic.
- Add `src/app.rs` tests for remaining keyboard shortcut branches (Alt+Q/Ctrl+Q, Shift/Alt+F3, Ctrl+Plus/Minus/0, Alt+Left/Right, Esc clear), plus `handle_file_drop` error paths (empty list, too many files, directory with no markdown).
- Verify coverage; target `app.rs` >=97% and `column_spec.rs` >=95%.

## Stage 3: Renderer Helpers (unit-level)
- Add targeted tests for `InlineSpan::text_content`/`is_text_like`, `LayoutJobCache` eviction, `element_plain_text` variants, `to_superscript` mappings, and `hash_inline_spans`/`parse_inline_spans_with_breaks` edge cases.
- Add parsing tests for list/blockquote/table branches with crafted markdown.

## Stage 4: Renderer Rendering Paths (integration-level)
- Build complex markdown fixtures to exercise `render_list`, `render_table_tablebuilder`, `render_code_block` (highlight and fallback), mermaid error/queue branches, image/emoji texture paths, and highlighted text rendering.
- Use forced render actions to cover hover/click paths in inline link/image rendering.

## Stage 5: Final Sweep
- Rerun coverage; identify remaining line gaps and patch with minimal tests.
- Stop when `src/` line coverage >=98%.
