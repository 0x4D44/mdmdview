# Code Review Report - Full Repository

**Date:** 2025-12-08  
**Reviewer:** Codex (GPT-5)  
**Scope:** Entire `mdmdview` codebase (Rust sources, build/CI, examples).  
**Reference Plan:** `wrk_docs/2025.12.08 - CR Plan - Full Repo.md`

## Method
- Inventory of all Rust sources, build scripts, CI, and examples.
- Deep read of core modules: `src/main.rs`, `src/app.rs`, `src/window_state.rs`, `src/markdown_renderer.rs`, `src/table_support/*`, `src/emoji_*`, `build.rs`, `Cargo.toml`.
- Targeted static review for error handling, panics, network use, persistence, caching, and UX flows.
- Verified prior automated tests already green (`cargo test` run on 2025-12-08).
- UI smoke via `mdscreensnap` covered tables, mixed markdown, images, syntax highlighting, lists (see 2025.12.08 screenshots referenced in UI smoke plan).

## Findings (ordered by severity)
No P1/P2 blocking issues discovered. Two P3 observations and a few P4 nits.

### P3 (medium)
1) **Link opening has minimal validation** (`src/markdown_renderer.rs`: webbrowser open on click). Malformed or extremely long URLs could still be attempted. Mitigation: consider basic scheme allowlist (`http`, `https`, `mailto`) and length cap before launching the browser; surface error toast when rejected.

### P4 (low)
1) **Window state persistence** (`src/window_state.rs`): falls back to plaintext file + registry (Windows) without logging failures except for registry write. Non-fatal, but adding debug logs for file write/read errors would help support.
2) **Command-line parsing** (`src/main.rs`): accepts only first positional as file and ignores extra args silently. Consider emitting a help/usage message when extra args are supplied.

## Positive Notes
- **Defensive window restore**: `sanitize_window_state` clamps coordinates/sizes and rejects non-finite values, reducing bad-state crashes.
- **Unicode-robust file loading**: `read_file_lossy` retries with `from_utf8_lossy` on invalid UTF-8 and normalizes line endings.
- **Table width persistence**: recent fix correctly skips re-saving on font-size change and is covered by regression test.
- **Extensive unit coverage**: ~90 tests spanning renderer parsing, tables, zoom, window state, app behaviors, sample files, column stats.
- **CI alignment**: GitHub Actions enforces `fmt` + `clippy` before release build; release pipeline builds Windows resources via `build.rs`.

## Testing / Verification
- Automated: `cargo fmt`, `cargo test` (2025-12-08 run, all green).
- Manual (no-keyboard UI smoke): tables, mixed content, images, syntax highlighting, lists rendered cleanly; no tofu observed. Screenshots documented in `wrk_docs/2025.12.08 - UI Render Smoke (No Keyboard).md`.

## Recommendations & Next Steps
1) Add URL allowlist/length guard before invoking `webbrowser::open`; log or toast on rejection. (P3)
4) Emit usage/help when multiple CLI args are provided or add `--help` flag. (P4)
5) Log file-based window-state read/write failures at debug level for supportability. (P4)

Overall, the codebase is solid: strong test coverage, clear separation of UI/state/rendering, and recent table width/zoom fix addresses the earlier defect. No blockers identified for release.***
