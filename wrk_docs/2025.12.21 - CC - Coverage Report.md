# Code Coverage Review (Baseline) - 2025.12.21

## Scope and Method
- Command: `cargo llvm-cov --workspace --all-targets --summary-only --json --output-path wrk_docs/coverage-baseline.json`
- Supplement: `cargo llvm-cov --workspace --all-targets --text --show-missing-lines --output-path wrk_docs/coverage-baseline.txt`
- Coverage includes `src/` + bin target + examples; generated `target/llvm-cov-target` files were included in totals.
- Build script (`build.rs`) is not included by default (needs `--include-build-script`).

## Overall Metrics (from cargo-llvm-cov JSON)
- Line coverage: 41.90% (2918 / 6965)
- Function coverage: 41.45% (252 / 608)
- Region coverage: 40.98% (4900 / 11958)
- Branch coverage: 0 reported (not enabled)
- Excluding generated `target/` files: 43.42% (2918 / 6721)

## Per-File Line Coverage (project sources only)
| File | Covered / Lines | Line % |
| --- | --- | --- |
| `src/emoji_assets.rs` | 0 / 138 | 0.00% |
| `src/window_state.rs` | 0 / 119 | 0.00% |
| `src/emoji_catalog.rs` | 38 / 102 | 37.25% |
| `src/app.rs` | 747 / 1961 | 38.09% |
| `src/markdown_renderer.rs` | 1551 / 3589 | 43.22% |
| `src/main.rs` | 66 / 144 | 45.83% |
| `src/table_support/metrics.rs` | 67 / 108 | 62.04% |
| `src/table_support/column_spec.rs` | 396 / 505 | 78.42% |
| `src/sample_files.rs` | 53 / 55 | 96.36% |

## Test Distribution (unit tests in source files)
| File | Tests |
| --- | --- |
| `src/app.rs` | 40 |
| `src/markdown_renderer.rs` | 31 |
| `src/sample_files.rs` | 8 |
| `src/table_support/column_spec.rs` | 8 |
| `src/table_support/metrics.rs` | 2 |
| `src/main.rs` | 3 |
| `src/window_state.rs` | 0 |
| `src/emoji_assets.rs` | 0 |
| `src/emoji_catalog.rs` | 0 |
| `build.rs` | 4 (not measured in coverage run) |

## Highest-Risk Coverage Gaps
- `src/app.rs`: Large UI/update paths untested (menu rendering, search dialog, drag/drop overlay, shortcuts that require egui input, window persistence, raw editor behavior). These are core UX flows.
- `src/markdown_renderer.rs`: Parsing-to-render pipeline only partially covered. Many rendering paths (inline context menus, image resolution, table layout caching, link handling, highlight rendering, emoji fallback) remain untested.
- `src/emoji_assets.rs` + `src/window_state.rs`: 0% coverage; these are used at runtime for emoji fallback and window state persistence.
- `src/main.rs`: CLI/entry and style configuration mostly untested; `configure_egui_style` and option handling paths are not exercised.

## Tooling/Scope Notes
- Generated bindings under `target/llvm-cov-target/**` show up as 0% and slightly lower overall coverage; future coverage runs should ignore them with `--ignore-filename-regex "target/llvm-cov-target"`.
- `build.rs` has tests but is not part of the default coverage report; add `--include-build-script` if build script coverage is desired.
- `navigation_tests_backup.rs` and `analyze_text.rs` are not part of the crate targets and are not in coverage scope.

## Summary
Baseline coverage is low (41.9% line coverage), concentrated in `src/app.rs` and `src/markdown_renderer.rs`. Small utility modules have either zero or minimal tests, and the UI rendering stack is largely untested. Achieving high coverage requires both targeted unit tests for small modules and broader render/update harness tests for egui-driven paths.
