# 2026.01.12 - Branch Coverage Improvement Plan

## Goal
Increase overall branch coverage to >=95% (and keep it above 90%) as reported by `cargo +nightly llvm-cov --branch`.

## Baseline (from 2026.01.12 run)
- Total branch coverage: 100.00% (2082 branches, 0 missed) when excluding generated bindings
- Largest gaps by missed branches:
  - `src/mermaid_renderer.rs`: 100.00% (0 missed)
  - `src/markdown_renderer.rs`: 100.00% (0 missed)
  - `src/app.rs`: 100.00% (0 missed)
- Generated bindings under `target/llvm-cov-target` show 0% coverage (expected for generated code).

## Strategy Overview
1. Keep `src/markdown_renderer.rs`, `src/mermaid_renderer.rs`, and `src/app.rs` stable now that they are at 100% branches.
2. Prefer default test threads for coverage runs; single-threaded runs timed out in this environment.
3. Consider excluding generated bindings in reporting to focus on project sources.

## Plan by Area

### 1) Markdown Renderer (complete)
Targets (examples from `wrk_docs/coverage-missing-branches.txt`):
- None remaining; branch coverage now 100%.

Test mechanics:
- Use `with_test_ui`/`run_frame_with_input` to simulate pointer and layout frames.
- Prefer short, deterministic spans and fixed rect sizes to avoid font-dependent drift.

### 2) Mermaid Renderer (complete)
Targets:
- None remaining; branch coverage now 100%.

Test mechanics:
- Keep SVG strings minimal and deterministic.
- Gate QuickJS-only branches with feature flags to avoid flaky CI behavior.

### 3) App (complete)
Targets:
- None remaining; branch coverage now 100%.

## Coverage Hygiene
- Use `cargo +nightly llvm-cov --branch --json --output-path wrk_docs\coverage.json -q` for faster runs; fall back to `-- --test-threads=1` only when it completes in time.
- Exclude generated bindings: `--ignore-filename-regex "target/llvm-cov-target/.*/(egl_bindings|wgl_extra_bindings)\.rs"`.

## Status Update (2026.01.12)
- Regenerated coverage outputs with an ignore regex for glutin bindings; `wrk_docs/coverage-missing-branches.txt` is now empty.

## Success Criteria
- `cargo +nightly llvm-cov --branch` reports >=95% branch coverage for project sources.
- All new tests run reliably on Windows without timeouts.
