# Recovery Plan - Table Dividers & Column Widths
**Date:** 2025-11-17
**Branch:** feat/table-dividers
**Context:** Power cut occurred while Stage 3/4 work (table metrics + divider overlay) was mid-flight. Working tree now contains duplicate helper definitions in `src/markdown_renderer.rs`, partially wired column heuristics, and no integration between the new metrics helpers and the renderer.

## Status Snapshot
- Journal entry 2025-11-14 21:00 ET showed Stage 4 just kicking off in `src/markdown_renderer.rs`; Stage 3/4 integration is now functional (table metrics, persisted widths, divider overlay, repaint throttling).
- Latest plan/HLD (2025-11-14) still governs the scope; heuristics landed earlier and remain aligned.
- Renderer compiles cleanly after deduplicating the stats helpers, routing `TableColumnContext`, and wiring the metrics/width capture path.
- Custom dividers + persisted widths are live behind the overhaul renderer; remaining verification is primarily QA/DPI coverage plus any optional UX polish.
- The stray `resolved_widths[Description]` artifact has been deleted and `.gitignore` reverted.

## Next Steps
1. **Manual QA & screenshots**
   - Exercise `examples/regressions/table-threat-model.md` across 100/125/150â€¯% DPI, resize the viewport, and confirm dividers stay aligned while Examples keeps the remainder.
   - Capture before/after screenshots for README/QA artifacts and verify persisted widths survive restarts + resizes.
2. **Optional UX follow-ups**
   - Decide whether to expose a divider opt-out flag (per Risk table) now that the default overlay is live.
   - Evaluate whether persisted widths should reset when DPI/font scale changes drastically; at minimum document expected behavior for this release.
   - If user-driven drag detection needs further plumbing (e.g., `PendingResize` integration), prototype and document scope.
3. **Docs & release prep**
   - Fold divider details/screenshots into README + QA guide (docs/QA-table-wrap.md already mentions the check; add screenshots + release notes once QA completes).
   - Prep PR summary + test plan referencing the completed checklist below.

## Open Questions / Risks
- Do we need an opt-out flag for dividers if GPU fill issues resurface? (HLD left it optional.)
- What UX should we provide for persisted widths when font/DPI changes drastically (reset vs clamp)?
- Should metrics persistence survive app restarts, or remain in-memory per session?

## Validation Checklist (post-resume)
- [x] `cargo fmt` (2025-11-18)
- [x] `cargo test column_spec` (2025-11-18)
- [x] `cargo test` (2025-11-18)
- [x] `cargo clippy --all-targets -D warnings` (2025-11-18)
- [ ] Manual QA on `examples/regressions/table-threat-model.md`
